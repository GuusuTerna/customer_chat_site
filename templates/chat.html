<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Live Chat</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <img src="{{ url_for('static', filename='depop-iconn.png') }}" alt="Depop Logo" style="height: 80px; margin-bottom: 10px;">

        <h1>Chat Support</h1>
        <p>Ask us anything, weâ€™re here to help.</p>
    </div>

    <div id="chat-box">
        <div id="messages"></div>
        <div id="input-area">
            <input type="text" id="msgInput" placeholder="Type your message..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="/" class="nav-link">Home</a>
        <a href="/chat" class="nav-link active">Chat</a>
    </div>

    <script>
    const socket = io();

    // Auto-send question if it was passed from the FAQ
    window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const question = urlParams.get('question');
        if (question) {
            socket.emit('message', {
                user: "{{ username }}",
                text: question
            });
        }
    };

    socket.on('message', function(msg) {
        const div = document.getElementById('messages');
        const isMine = msg.startsWith(`[{{ username }}]`);
        const bubbleClass = isMine ? "bubble mine" : "bubble other";
        div.innerHTML += `<div class="${bubbleClass}">${msg}</div>`;
        div.scrollTop = div.scrollHeight;
    });

    function sendMessage() {
        const input = document.getElementById('msgInput');
        const message = input.value.trim();
        if (message !== '') {
            socket.emit('message', {
                user: "{{ username }}",
                text: message
            });
            input.value = '';
        }
    }
</script>



</body>
</html>
